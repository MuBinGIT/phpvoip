# phpvoip

模块是用户(UAC)在引擎内部的代理人，也即 UAS。

引擎从网络收到 INVITE 后:

* 引擎先调用 callin()，寻找会话发起者的代理人模块，代理人模块返回一个 callee 会话。
* 接着引擎要调用 callout()，找出会话接收者的代理模块，接收者的代理人模块应该返回一个 caller 会话。
* 引擎将管理由模块返回的 callee 和 caller 会话，这两个会话将脱离模块的控制。
* callee 会话与会话发起者进行通信，caller 会话与会话接收者进行通信。

所以说，callin() 是用于找出 from 的代理人（模块），callout() 是用于找出 to 的代理人。

如果 from 或者 to 是一个模块，也就是说，会话的发起或接收不是用户(UAC)，而是代理人本身。因为代理人本身也可以作为一个 UAC。

如果模块是会话的发起者，模块发出 INVITE 的流程:

* 模块(mod_a)生成一个 caller 会话，此会话由模块自己管理，将发送 INVITE 给引擎。
* 引擎收到 INVITE 后，执行与网络收到 INVITE 相同的流程。
* 所以，mod_a 将在 callin() 方法返回一个 callee 会话给引擎管理。
* 引擎接着执行后续的逻辑。

如果模块是会话的接收者，模块接收 INVITE 的流程:

* 模块在 callout() 方法中发现自己是会话接收者。
* 模块创建一个 caller 会话返回给引擎管理，同时，创建一个对应的 callee 会话自己管理。
